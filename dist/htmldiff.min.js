/*! For license information please see htmldiff.min.js.LICENSE.txt */
!function(t,e){if("object"==typeof exports&&"object"==typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var r=e();for(var n in r)("object"==typeof exports?exports:t)[n]=r[n]}}(self,(()=>(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{default:()=>et});const r=0,n=1,o=2,i=3,a=4;function s(t){return s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},s(t)}function u(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,c(n.key),n)}}function c(t){var e=function(t){if("object"!=s(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=s(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==s(e)?e:e+""}var l=function(){return t=function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.startInOld=e,this.startInNew=r,this.size=n},(e=[{key:"endInOld",get:function(){return this.startInOld+this.size}},{key:"endInNew",get:function(){return this.startInNew+this.size}}])&&u(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}(),f=/^\s*<\/?[^>]+>\s*$/,h=/<[^\s>]+/,d=/^(\s|&nbsp;)+$/,p=/[\w\#@-]+/,y=["<img"];function v(t){return!y.some((function(e){return null!==t&&t.startsWith(e)}))&&f.test(t)}function m(t,e,r){return["<",e,' class="',r,'">',t,"</",e,">"].join("")}function g(t){return"<"===t}function b(t){return"&"===t}function w(t){return d.test(t)}function I(t){return p.test(t)}function x(t){return x="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},x(t)}function O(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return k(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?k(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function k(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function S(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,W(n.key),n)}}function W(t){var e=function(t){if("object"!=x(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=x(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==x(e)?e:e+""}function j(t,e,r){return t.push(e),t.length>r&&t.shift(),t.length!==r?null:t.join("")}var E=function(){return t=function t(e,r,n,o,i,a,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.oldWords=e,this.newWords=r,this.startInOld=n,this.endInOld=o,this.startInNew=i,this.endInNew=a,this.options=s},(e=[{key:"indexNewWords",value:function(){this.wordIndices=new Map;for(var t=[],e=this.startInNew;e<this.endInNew;e++){var r=j(t,this.normalizeForIndex(this.newWords[e]),this.options.blockSize);null!==r&&(this.wordIndices.has(r)?this.wordIndices.get(r).push(e):this.wordIndices.set(r,[e]))}}},{key:"normalizeForIndex",value:function(t){return t=function(t){return v(t)?function(t){return h.exec(t)[0]+(/<figure.+?class=".*?table.*?"/.test(t)||/<figure.+?class=".*?image.*?"/.test(t)?' class="'+t.match(/class=".*?(table|image).*?"/)[1]+'"':"")+(/<fig(?:ure|caption).+?id=".+?"/.test(t)?' id="'+t.match(/id="(.+?)"/)[1]+'"':"")+(t.endsWith("/>")?"/>":">")}(t):t}(t),this.options.IgnoreWhiteSpaceDifferences&&w(t)?" ":t}},{key:"findMatch",value:function(){var t=this;if(this.indexNewWords(),this.removeRepeatingWords(),0===this.wordIndices.length)return null;for(var e=this.startInOld,r=this.startInNew,n=0,o=new Map,i=this.options.blockSize,a=[],s=function(s){var u=t.normalizeForIndex(t.oldWords[s]),c=j(a,u,i);if(null===c)return 0;var l=new Map;if(!t.wordIndices.has(c))return o=l,0;var f,h=O(t.wordIndices.get(c));try{var d=function(){var a=f.value,u=(o.has(a-1)?o.get(a-1):0)+1;if(l.set(a,u),u>n){var c=!1,h=!1;t.options.oldFigureBlocks.forEach((function(t,e){s>=t[0]&&s<=t[1]&&(c=!0)})),t.options.newFigureBlocks.forEach((function(t,e){a>=t[0]&&a<=t[1]&&(h=!0)})),c==h&&(e=s-u-i+2,r=a-u-i+2,n=u)}};for(h.s();!(f=h.n()).done;)d()}catch(t){h.e(t)}finally{h.f()}o=l},u=this.startInOld;u<this.endInOld;u++)s(u);return 0!==n?new l(e,r,n+i-1):null}},{key:"removeRepeatingWords",value:function(){var t,e=this.newWords.length+this.options.repeatingWordsAccuracy,r=O(Array.from(this.wordIndices.entries()).filter((function(t){return t[1].length>e})).map((function(t){return t[0]})));try{for(r.s();!(t=r.n()).done;){var n=t.value;this.wordIndices.delete(n)}}catch(t){r.e(t)}finally{r.f()}}}])&&S(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();function N(t){return N="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},N(t)}function T(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,L(n.key),n)}}function P(t,e,r){return e&&T(t.prototype,e),r&&T(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function L(t){var e=function(t){if("object"!=N(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=N(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==N(e)?e:e+""}var A=P((function t(e,r,n,o,i){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.action=e,this.startInOld=r,this.endInOld=n,this.startInNew=o,this.endInNew=i}));function M(t){return M="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},M(t)}function _(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,D(n.key),n)}}function C(t,e,r){return e&&_(t.prototype,e),r&&_(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function D(t){var e=function(t){if("object"!=M(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=M(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==M(e)?e:e+""}var F=C((function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.blockSize=0,this.repeatingWordsAccuracy=0,this.ignoreWhitespaceDifferences=!1}));const z=0,B=1,G=2,$=3;function R(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function q(t,e){for(var r={mode:z,currentWord:[],words:[]},n=function(t,e){var r=new Map;if(null===e)return r;var n,o=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return R(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?R(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}(e);try{for(o.s();!(n=o.n()).done;)for(var i=n.value,a=void 0;null!==(a=i.exec(t));){if(r.has(a.index))throw new Error("One or more block expressions result in a text sequence that overlaps. Current expression: "+i.toString());r.set(a.index,a.index+a[0].length)}}catch(t){o.e(t)}finally{o.f()}return r}(t,e),o=!!n.size,i=!1,a=-1,s=0;s<t.length;s++){var u=t[s];if(o&&(a===index&&(a=-1,i=!1),n.has(index)&&(i=!0,a=n.get(index)),i))r.currentWord.push(u),r.mode=z;else switch(r.mode){case z:g(u)?U(r,"<",B):b(u)?U(r,u,$):w(u)?U(r,u,G):I(u)&&(0===r.currentWord.length||I(r.currentWord[r.currentWord.length-1]))?r.currentWord.push(u):U(r,u,z);break;case B:">"===u?(r.currentWord.push(u),r.words.push(r.currentWord.join("")),r.currentWord=[],r.mode=w(u)?G:z):r.currentWord.push(u);break;case G:g(u)?U(r,u,B):b(u)?U(r,u,$):w(u)?r.currentWord.push(u):U(r,u,z);break;case $:if(g(u))U(r,u,B);else if(w(u))U(r,u,G);else if(";"===u){var c=!0;if(0!==r.currentWord.length&&(r.currentWord.push(u),r.words.push(r.currentWord.join("")),r.words.length>2&&w(r.words[r.words.length-2])&&w(r.words[r.words.length-1]))){var l=r.words[r.words.length-2],f=r.words[r.words.length-1];r.words.splice(r.words.length-2,2),r.currentWord=[(l+f).split()],r.mode=G,c=!1}c&&(r.currentWord=[],r.mode=z)}else I(u)?r.currentWord.push(u):U(r,u,z)}}return 0!==r.currentWord.length&&r.words.push(r.currentWord.join("")),r.words}function U(t,e,r){0!==t.currentWord.length&&t.words.push(t.currentWord.join("")),t.currentWord=[e],t.mode=r}function Y(t){return Y="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Y(t)}function H(){H=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function l(t,e,r,n){var i=e&&e.prototype instanceof m?e:m,a=Object.create(i.prototype),s=new T(n||[]);return o(a,"_invoke",{value:W(t,r,s)}),a}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=l;var h="suspendedStart",d="suspendedYield",p="executing",y="completed",v={};function m(){}function g(){}function b(){}var w={};c(w,a,(function(){return this}));var I=Object.getPrototypeOf,x=I&&I(I(P([])));x&&x!==r&&n.call(x,a)&&(w=x);var O=b.prototype=m.prototype=Object.create(w);function k(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(o,i,a,s){var u=f(t[o],t,i);if("throw"!==u.type){var c=u.arg,l=c.value;return l&&"object"==Y(l)&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,a,s)}),(function(t){r("throw",t,a,s)})):e.resolve(l).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,s)}))}s(u.arg)}var i;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return i=i?i.then(o,o):o()}})}function W(e,r,n){var o=h;return function(i,a){if(o===p)throw Error("Generator is already running");if(o===y){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var s=n.delegate;if(s){var u=j(s,n);if(u){if(u===v)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=p;var c=f(e,r,n);if("normal"===c.type){if(o=n.done?y:d,c.arg===v)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(o=y,n.method="throw",n.arg=c.arg)}}}function j(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,j(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),v;var i=f(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,v;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,v):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,v)}function E(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(E,this),this.reset(!0)}function P(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return i.next=i}}throw new TypeError(Y(e)+" is not iterable")}return g.prototype=b,o(O,"constructor",{value:b,configurable:!0}),o(b,"constructor",{value:g,configurable:!0}),g.displayName=c(b,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===g||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,b):(t.__proto__=b,c(t,u,"GeneratorFunction")),t.prototype=Object.create(O),t},e.awrap=function(t){return{__await:t}},k(S.prototype),c(S.prototype,s,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new S(l(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},k(O),c(O,u,"Generator"),c(O,a,(function(){return this})),c(O,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=P,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(N),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if("root"===a.tryLoc)return o("end");if(a.tryLoc<=this.prev){var u=n.call(a,"catchLoc"),c=n.call(a,"finallyLoc");if(u&&c){if(this.prev<a.catchLoc)return o(a.catchLoc,!0);if(this.prev<a.finallyLoc)return o(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return o(a.catchLoc,!0)}else{if(!c)throw Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return o(a.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,v):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),v},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),N(r),v}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;N(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:P(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),v}},e}function J(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=function(t,e){if(t){if("string"==typeof t)return K(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?K(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){s=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(s)throw i}}}}function K(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function Q(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,V(n.key),n)}}function V(t){var e=function(t){if("object"!=Y(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=Y(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Y(e)?e:e+""}var X=new Map([]),Z=/<((strong)|(b)|(i)|(dfn)|(em)|(big)|(small)|(u)|(sub)|(sup)|(strike)|(s))[\>\s]+/gi,tt=function(){return t=function t(e,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.content=[],this.newText=r,this.oldText=e,this.specialTagDiffStack=[],this.newWords=[],this.oldWords=[],this.matchGranularity=0,this.blockExpressions=[],this.repeatingWordsAccuracy=1,this.ignoreWhiteSpaceDifferences=!1,this.orphanMatchThreshold=0},e=[{key:"build",value:function(){if(this.oldText===this.newText)return this.newText;this.splitInputsIntoWords(),this.matchGranularity=Math.min(10,this.oldWords.length,this.newWords.length);var t,e=J(this.operations());try{for(e.s();!(t=e.n()).done;){var r=t.value;this.performOperation(r)}}catch(t){e.e(t)}finally{e.f()}return this.content.join("")}},{key:"addBlockExpression",value:function(t){this.blockExpressions.push(t)}},{key:"splitInputsIntoWords",value:function(){this.oldWords=q(this.oldText,this.blockExpressions),this.oldText=null,this.newWords=q(this.newText,this.blockExpressions),this.newText=null}},{key:"performOperation",value:function(t){switch(t.action){case r:this.processEqualOperation(t);break;case n:this.processDeleteOperation(t,"diffdel");break;case o:this.processInsertOperation(t,"diffins");break;case i:break;case a:this.processReplaceOperation(t)}}},{key:"processReplaceOperation",value:function(t){this.processDeleteOperation(t,"diffmod"),this.processInsertOperation(t,"diffmod")}},{key:"processInsertOperation",value:function(t,e){var r=this.newWords.filter((function(e,r){return r>=t.startInNew&&r<t.endInNew}));this.insertTag("ins",e,r)}},{key:"processDeleteOperation",value:function(t,e){var r=this.oldWords.filter((function(e,r){return r>=t.startInOld&&r<t.endInOld}));this.insertTag("del",e,r)}},{key:"processEqualOperation",value:function(t){var e=this.newWords.filter((function(e,r){return r>=t.startInNew&&r<t.endInNew}));this.content.push(e.join(""))}},{key:"insertTag",value:function(t,e,r){for(;r.length;){var n=this.extractConsecutiveWords(r,(function(t){return!v(t)})),o="",i=!1;if(0!==n.length){var a=m(n.join(""),t,e);this.content.push(a)}else{if(Z.test(r[0])){var s=r[0].match(Z);if(s="<"+s[0].replace(/(<|>| )/g,"")+">",this.specialTagDiffStack.push(s),o='<ins class="mod">',"del"===t)for(r.shift();r.length>0&&Z.test(r[0]);)r.shift()}else if(X.has(r[0])){var u=0===this.specialTagDiffStack.length?null:this.specialTagDiffStack.pop();if(null!==u&&u===r[0].replace(/\//g,"")&&(o="</ins>",i=!0),"del"===t)for(r.shift();r.length>0&&X.has(r[0]);)r.shift()}if(0===r.length&&0===o.length)break;i?this.content.push(o+this.extractConsecutiveWords(r,v).join("")):this.content.push(this.extractConsecutiveWords(r,v).join("")+o)}}}},{key:"extractConsecutiveWords",value:function(t,e){for(var r=null,n=0;n<t.length;n++){var o=t[n];if(0===n&&" "===o&&(t[n]="&nbsp;"),!e(o)){r=n;break}}if(null!==r){var i=t.filter((function(t,e){return e>=0&&e<r}));return r>0&&t.splice(0,r),i}var a=t.filter((function(e,r){return r>=0&&r<t.length}));return t.splice(0,t.length),a}},{key:"operations",value:function(){var t=0,e=0,s=[],u=this.matchingBlocks();u.push(new l(this.oldWords.length,this.newWords.length,0));var c,f=J(this.removeOrphans(u));try{for(f.s();!(c=f.n()).done;){var h,d=c.value,p=t===d.startInOld,y=e===d.startInNew;(h=p||y?p&&!y?o:p?i:n:a)!==i&&s.push(new A(h,t,d.startInOld,e,d.startInNew)),0!==d.length&&s.push(new A(r,d.startInOld,d.endInOld,d.startInNew,d.endInNew)),t=d.endInOld,e=d.endInNew}}catch(t){f.e(t)}finally{f.f()}return s}},{key:"removeOrphans",value:H().mark((function t(e){var r,n,o,i,a,s,u,c;return H().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=null,n=null,o=J(e),t.prev=3,o.s();case 5:if((i=o.n()).done){t.next=28;break}if(a=i.value,null!==n){t.next=11;break}return r=new l(0,0,0),n=a,t.abrupt("continue",26);case 11:if(!(r.endInOld===n.startInOld&&r.endInNew===n.startInNew||n.endInOld===a.startInOld&&n.endInNew===a.startInNew)){t.next=17;break}return t.next=14,n;case 14:return r=n,n=a,t.abrupt("continue",26);case 17:if(s=function(t,e){return t+e.length},u=this.oldWords.slice(r.endInOld,a.startInOld).reduce(s,0),c=this.newWords.slice(r.endInNew,a.startInNew).reduce(s,0),!(this.newWords.slice(n.startInNew,n.endInNew).reduce(s,0)>Math.max(u,c)*this.orphanMatchThreshold)){t.next=24;break}return t.next=24,n;case 24:r=n,n=a;case 26:t.next=5;break;case 28:t.next=33;break;case 30:t.prev=30,t.t0=t.catch(3),o.e(t.t0);case 33:return t.prev=33,o.f(),t.finish(33);case 36:return t.next=38,n;case 38:case"end":return t.stop()}}),t,this,[[3,30,33,36]])}))},{key:"matchingBlocks",value:function(){for(var t=[],e=[],r=[],n=-1;-1!=(n=this.oldWords.indexOf("<figcaption>",n+1));){var o=n,i=this.oldWords.indexOf("</figcaption>",n+1);e.push([o,i]),n=i}for(n=-1;-1!=(n=this.newWords.indexOf("<figcaption>",n+1));){var a=n,s=this.newWords.indexOf("</figcaption>",n+1);r.push([a,s]),n=s}return n=-1,this.findMatchingBlocks(0,this.oldWords.length,0,this.newWords.length,t,e,r),t}},{key:"findMatchingBlocks",value:function(t,e,r,n,o,i,a){var s=this.findMatch(t,e,r,n,i,a);null!==s&&(t<s.startInOld&&r<s.startInNew&&this.findMatchingBlocks(t,s.startInOld,r,s.startInNew,o,i,a),o.push(s),s.endInOld<e&&s.endInNew<n&&this.findMatchingBlocks(s.endInOld,e,s.endInNew,n,o,i,a))}},{key:"findMatch",value:function(t,e,r,n,o,i){for(var a=this.matchGranularity;a>0;a--){var s=new F;s.blockSize=a,s.repeatingWordsAccuracy=this.repeatingWordsAccuracy,s.ignoreWhitespaceDifferences=this.ignoreWhiteSpaceDifferences,s.oldFigureBlocks=o,s.newFigureBlocks=i;var u=new E(this.oldWords,this.newWords,t,e,r,n,s).findMatch();if(null!==u)return u}return null}}],e&&Q(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e}();tt.execute=function(t,e){return new tt(t,e).build()};const et=tt;return window.HtmlDiff=tt,e})()));